<!-- rating.html -->

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rate the Site</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
</head>
<body>

<div id="ratingContainer">
    <h1>Rate the Site</h1>
    <div>
        <p>Your Rating:</p>
        <div id="stars">
            <span class="star" data-value="1">&#9733;</span>
            <span class="star" data-value="2">&#9733;</span>
            <span class="star" data-value="3">&#9733;</span>
            <span class="star" data-value="4">&#9733;</span>
            <span class="star" data-value="5">&#9733;</span>
        </div>
        <button id="submitRating">Submit Rating</button>
    </div>
    <div>
        <p>Average Site Rating: <span id="avgRating">--</span></p>
    </div>
    <!-- Hidden input field for CSRF token -->
    <input type="hidden" id="csrf_token" value="{% csrf_token %}">
</div>

<script>
    $(document).ready(function() {
        $('.star').click(function() {
            $(this).addClass('selected').prevAll('.star').addClass('selected');
            $(this).nextAll('.star').removeClass('selected');
        });

        $('#submitRating').click(function() {
            var rating = $('.star.selected').length;
            var csrfToken = $('#csrf_token').val(); // Get the CSRF token value
            $.ajax({
                type: 'POST',
                url: '{% url "rate_site" %}',
                data: {
                    'rating': rating,
                    'csrfmiddlewaretoken': csrfToken // Include the CSRF token
                },
                dataType: 'json',
                success: function(response) {
                    if (response.success) {
                        alert('Rating submitted successfully!');
                    } else {
                        alert('Failed to submit rating!');
                    }
                }
            });
        });

        function updateAverageRating() {
            $.ajax({
                type: 'GET',
                url: '{% url "get_average_rating" %}',
                dataType: 'json',
                success: function(response) {
                    $('#avgRating').text(response.average_rating);
                }
            });
        }

        updateAverageRating();
    });
</script>

</body>
</html>
